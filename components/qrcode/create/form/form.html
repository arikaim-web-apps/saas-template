{% set user_id = service('access').getId() %}
{% set logged = service('access').isLogged() %}
{% if uuid is not empty %}
    {% set qrcode = createModel('QrCode','qrcode').findQrCode(uuid,user_id) %}
    {% set options_items = [ 
        { 
            title: fields.shape.label,
            content: component('current>qrcode.create.form.shape',{ styles: styles})
        },                              
        { 
            title: fields.frame.label,
            content: component('current>qrcode.create.form.frame',{ logged: logged, styles: styles})
        },
        { 
            title: fields.logo.label,
            content: (logged == true) ? component('current>images.view',{ mode: 'select' }) : ''
        },
        { 
            title: fields.color.label,
            content: component('current>qrcode.create.colors',{ logged: logged, styles: styles })
        },
        { 
            title: fields.options.label,
            content: component('current>qrcode.create.form.options',{ logged: logged, styles: styles })
        }                                               
    ] %}
{% else %}
    {% set options_items = [       
        { 
            title: fields.shape.label,
            content: component('current>qrcode.create.form.shape',{ styles: styles})
        },                         
        { 
            title: fields.frame.label,
            content: component('current>qrcode.create.form.frame',{ logged: logged, styles: styles})
        },
        { 
            title: fields.logo.label,
            content: (logged == true) ? component('current>images.view',{ mode: 'select' }) : ''
        },
        { 
            title: fields.background.label,
            content: (logged == true) ? component('current>images.view',{ mode: 'select', field_id: 'background' }) : ''
        },
        { 
            title: fields.color.label,
            content: component('current>qrcode.create.colors',{ logged: logged, styles: styles })
        },
        { 
            title: fields.options.label,
            content: component('current>qrcode.create.form.options',{ logged: logged, styles: styles })
        }                                              
    ] %}
{% endif %}
{% set total_qrcodes = service('qrcode.library').getQrCodesTotal(user_id) %}
{% set saved_qrcode = service('subscriptions').checkPlanFeatureQuota(user_id,'qrcode-save',total_qrcodes) %}
<form    
    class="ui form" 
    id="qucode_create_form">
    <input type="hidden" name="uuid" value="{{ uuid }}" id="uuid">
    <input type="hidden" id="save_field" name="save" value="{{ save|default(false) }}">
    <input type="hidden" name="logo_image" value="{{ logo_image }}" id="logo_image">  
    <input type="hidden" name="background" value="{{ background }}" id="background">  
    <input type="hidden" name="circleRadius" value="{{ circle_radius|default(0.0) }}" id="circleRadius">  
    <div    
        class="flex flex-col xs:flex-col sm:flex-col md:flex-col lg:flex-col">
        <div class="w-full lg:w-full md:w-full xs:w-full sm:w-full">           
            <div class="grid auto-rows-fr grid-cols-3 xs:grid-cols-1 md:grid-cols-3 gap-2">
                <div                   
                    id="preview" 
                    class="p-2">
                    {{ component('current>qrcode.create.preview',{ scale: qrcode.scale|default(5) }) }}                                                                                  
                </div>
                <div                 
                    class="flex-grow w-full col-span-2">                   
                    <div class="m-2" id="qrcode_content_type">
                        {{ component('current>qrcode.create.form.content.text',{}) }}
                    </div> 
                    <div class="m-2 {{ theme.qrcode.content.panel }}">
                        {{  component('current>accordion',{
                                class: 'w-full',
                                items: options_items                          
                            }) 
                        }}
                    </div>
                    <div class="mt-4 p-4 flex flex-row items-center place-content-between w-full ml-1 md:w-full xs:w-full sm:w-full"> 
                        <a 
                            data-tip="{{ tooltips.create }}"
                            class="inline-block preview-button bg-sky-500 text-white tooltip
                            {{ styles.buttons.create.class }}                         
                            {{ styles.buttons.create.hover }}">
                            {{ buttons.create }}
                        </a>                  
                        {% if saved_qrcode == true %}                                               
                            <btn data-tip="{{ tooltips.save }}" class="tooltip generate-button 
                                {{ styles.buttons.create.class }} 
                                {{ styles.buttons.create.color }} 
                                {{ styles.buttons.create.hover }}">
                                {{ buttons.create_and_save }}
                            </btn>                
                        {% endif %}                             
                    </div>                    
                    <div class="p-4">
                        <div 
                            id="error_message" 
                            class="error message errors hidden mt-2 p-2 px-4 font-bold text-red-500">
                        </div>  
                    </div>  
                    {% if saved_qrcode == false %}   
                        <div class="mt-4 p-4">
                            {{ component('current>subscriptions.feature',{ feature: 'qrcode-save' }) }}     
                        </div>                                                                  
                    {% endif %}     
                </div>    
            </div>
        </div>           
    </div>    
</form>